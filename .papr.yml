branches:
  - master
  - auto
  - try

host:
  distro: fedora/28/atomic
  specs:
     ram: 8192
     cpus: 4
required: true
timeout: 45m

tests:
  - CONTAINER_RUNTIME="podman" sh .papr_prepare.sh

artifacts:
  - build.log

context: "FAH28"
---

host:
  distro: centos/7/atomic/smoketested
  specs:
     ram: 8192
     cpus: 4
extra-repos:
    - name: epel
      metalink: https://mirrors.fedoraproject.org/metalink?repo=epel-7&arch=$basearch
      gpgcheck: 0
    - name: cri-o
      baseurl: https://cbs.centos.org/repos/virt7-container-common-candidate/$basearch/os
      gpgcheck: 0

required: true
timeout: 45m

tests:
  - sh .papr_prepare.sh

artifacts:
  - build.log

context: "CAH smoketested"


---

inherit: true
host:
    distro: fedora/28/cloud
    specs:
        ram: 8192
        cpus: 4
extra-repos:
    - name: crio_copr
      baseurl: https://copr-be.cloud.fedoraproject.org/results/baude/Upstream_CRIO_Family/fedora-28-x86_64/
      gpgcheck: 0
packages:
    - podman
    - buildah
tests:
    - sed 's/^expand-check.*/expand-check=0/g' -i /etc/selinux/semanage.conf
    - yum -y reinstall container-selinux
    - CONTAINER_RUNTIME="podman" sh .papr_prepare.sh
required: false
context: "Fedora fedora/28/cloud Podman"

---

container:
    image: registry.fedoraproject.org/fedora:28

packages:
    - btrfs-progs-devel
    - bzip2
    - device-mapper-devel
    - findutils
    - git
    - glib2-devel
    - gnupg
    - golang
    - libassuan-devel
    - make
    - ostree-devel
    - skopeo-containers
    - golang-github-cpuguy83-go-md2man

required: true
pulls: true

env:
    GOPATH: /go
    GOSRC: /go/src/github.com/projectatomic

tests:
    - mkdir -p $GOSRC && ln -s /var/tmp/checkout $GOSRC/libpod
    - cd $GOSRC/libpod && make darwin
    - cd $GOSRC/libpod && make install.tools && GOOS=darwin GOPATH=/go make validate

artifacts:
    - test-suite.log

context: "darwin CI"
